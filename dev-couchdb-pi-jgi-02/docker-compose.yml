version: '2'

services:
  kv:
    image: couchdb:2.3.0
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
      - FOWNER
      - SETGID
      - SETUID
    ports:
      - 5984:5984
    volumes:
      - kv.dev-couchdb-pi-jgi-02.data:/opt/couchdb/data
      - kv.dev-couchdb-pi-jgi-02.local:/opt/couchdb/etc/local.d
      - kv.dev-couchdb-pi-jgi-02.log:/opt/couchdb/var/log
  lb:
    image: registry.spin.nersc.gov/scott/filebeat:6.6.1-1
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
      - FOWNER
      - SETGID
      - SETUID
volumes:
  kv.dev-couchdb-pi-jgi-02.data:
    driver: rancher-nfs
    external: true
  kv.dev-couchdb-pi-jgi-02.local:
    driver: rancher-nfs
    external: true
  kv.dev-couchdb-pi-jgi-02.log:
    driver: rancher-nfs
    external: true
